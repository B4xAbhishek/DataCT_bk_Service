<!DOCTYPE html>
<html>
  <head>
    <title>Vue Ejs Test</title>
    <link href="/ejsAssets/css.css" rel="stylesheet" />
    <!-- <link href="/ejsAssets/css/materialdesignicons.min.css" rel="stylesheet" /> -->
    <link href="/ejsAssets/vuetify.min.css" rel="stylesheet" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui"
    />
  </head>
  <body>
    <div id="app">
      <v-app>
        <v-main>
          <v-container>
            <div class="mb-3">
              <v-card color="basil" flat>

                 <!-- headerr -->
                 <v-card style="background-color: white !important" class="pa-2">
                 <v-container>
                   <v-row class="mb-5" justify="center">
                       <img src="/ejsAssets/images/Lohia_Logo.png"
                         alt="LOGO"
                         width="300px">
                   </v-row>
                   
                 </v-container>
                 <v-container>
                 <v-card elevation="3" style="background-color: white !important" class="pa-5">
                   <v-row>
                   <v-row class="mt-5 mb-5" justify="center">
                       <h1 class="text-uppercase" style="color:#002160;">
         
                         ENERGY REPORT</h1>
                   </v-row>
                     
                   </v-row>
                   </v-card>
                   </v-container>
                 <div class="pa-2 mt-4">
                   <v-row  class="pa-1 d-flex justify-space-between">
                     <v-col
                       class="title d-flex justify-left">
                     <h4 class="text-uppercase" style="color:#002160;">Start Date: {{new Date(infoData['date']['start']).toDateString()}} </h4>
                     </v-col>
                     <v-col
                       class="title justify-right text-right">
                     <h4 class="text-uppercase" style="color:#002160;">End Date: {{new Date(infoData['date']['end']).toDateString()}} </h4>
                     </v-col>
           
                   
                   </v-row>
                   </div>

                 <v-divider></v-divider>
                </v-card>
                 <div class="printmedia">
                 </div>
                    <v-row v-for="item in infoData['parameters']" class="pt-1 d-flex justify-space-between">
                      <v-col
                        class=" subtitle mt-2 d-flex justify-start"
                        cols="12"
                        sm="12"
                        md="12"
                        lg="12"
                      > <h6 class="subtitle-head">{{item["name"]}}:</h6> <span> {{item["value"].toString()}}
                       </span></v-col
                      >
            
                    </v-row>
                  </div>
                  </v-card>
                  <!-- headerr -->
              <div class="printmedia">
              </div>

            <div id="counter-wrapper">
              <v-row align="center" class="pa-3">
                <v-col v-if="counterText && counterText['TOTAL ENERGY']">
                  <v-card light elevation="6">
                    <v-card-text>
                      <div class="d-flex flex-no-wrap justify-space-between">
                        <div>
                          <span class=""><small class="font-weight-bold">Total Energy:</small></span>
                          <p class="subtitle-2 mb-0 pa-0 text--primary">
                            {{ counterText['TOTAL ENERGY'] }}
                          </p>
                        </div>
                      </div>
                    </v-card-text>
                  </v-card>
                </v-col>
                <v-col v-if="counterText && counterText['TOTAL AVG POWER']">
                  <v-card light elevation="6">
                    <v-card-text>
                      <div class="d-flex flex-no-wrap justify-space-between">
                        <div>
                          <span class=""><small class="font-weight-bold">Total Avg Power:</small></span>
                          <p class="subtitle-2 mb-0 pa-0 text--primary">
                            {{ counterText['TOTAL AVG POWER'] }}
                          </p>
                        </div>
                      </div>
                    </v-card-text>
                  </v-card>
                </v-col>
                <!-- <v-col v-if="counterText && counterText['ENERGY PER PART']">
                  <v-card light elevation="6">
                    <v-card-text>
                      <div class="d-flex flex-no-wrap justify-space-between">
                        <div>
                          <span class=""><small class="font-weight-bold">Energy Per Part:</small></span>
                          <p class="subtitle-2 mb-0 pa-0 text--primary">
                            {{ counterText['ENERGY PER PART'] }}
                          </p>
                        </div>
                      </div>
                    </v-card-text>
                  </v-card>
                </v-col> -->
              </v-row>
            </div>
              
              <!-- table data -->
            <div class="my-5 ma-2" v-if="counterTable && counterTable['MACHINE WISE DATA']">
              <v-data-table
                :headers="counterTable['MACHINE WISE DATA'].column"
                :items="counterTable['MACHINE WISE DATA'].row"
                :server-items-length="counterTable['MACHINE WISE DATA'].row.length"
                :items-per-page="counterTable['MACHINE WISE DATA'].row.length"
                hide-default-footer
                class="elevation-5"
              >
                <template v-slot:top>
                  <v-toolbar flat>
                    <v-toolbar-title>MACHINE-WISE ENERGY DATA</v-toolbar-title>
                  </v-toolbar>
                </template>
              </v-data-table>
            </div>
            <!-- table data -->
            <div class="printmedia">
            </div>
            <!-- table data -->
            <div class="my-5 ma-2" v-if="counterTable && counterTable['MOLD WISE DATA']">
              <v-data-table
                :headers="counterTable['MOLD WISE DATA'].column"
                :items="counterTable['MOLD WISE DATA'].row"
                :server-items-length="counterTable['MOLD WISE DATA'].row.length"
                :items-per-page="counterTable['MOLD WISE DATA'].row.length"
                hide-default-footer
                class="elevation-5"
              >
                <template v-slot:top>
                  <v-toolbar flat>
                    <v-toolbar-title>MOLD-WISE ENERGY DATA</v-toolbar-title>
                  </v-toolbar>
                </template>
              </v-data-table>
            </div>
            <!-- table data -->
            <div class="printmedia">
            </div>
            <!-- table data -->
            <div class="my-5 ma-2" v-if="counterTable && counterTable['OVERALL MOST OCCURED REASON']">
              <v-data-table
                :headers="counterTable['OVERALL MOST OCCURED REASON'].column"
                :items="counterTable['OVERALL MOST OCCURED REASON'].row"
                :server-items-length="counterTable['OVERALL MOST OCCURED REASON'].row.length"
                :items-per-page="counterTable['OVERALL MOST OCCURED REASON'].row.length"
                hide-default-footer
                class="elevation-5"
              >
                <template v-slot:top>
                  <v-toolbar flat>
                    <v-toolbar-title>OVERALL MOST OCCURED REASON</v-toolbar-title>
                  </v-toolbar>
                </template>
              </v-data-table>
            </div>
            <!-- table data -->
                
                <!-- counter card -->
                <!-- <div id="counter-wrapper">
                  <v-row align="center" class="pa-3">
                  <v-col v-if="totalEnergy" cols="6" sm="12" lg="2">
                    <v-card light elevation="6">
                      <v-card-text>
                        <div class="d-flex flex-no-wrap justify-space-between">
                          <div>
                            <span class=""><small class="font-weight-bold">Total Energy:</small></span>
                            <p class="subtitle-2 mb-0 pa-0 text--primary">
                              {{ totalEnergy }}
                            </p>
                          </div>
                        </div>
                      </v-card-text>
                    </v-card>
                  </v-col>
                  <v-col v-if="totalavgPower" cols="6" sm="12" lg="2">
                    <v-card light elevation="6">
                      <v-card-text>
                        <div class="d-flex flex-no-wrap justify-space-between">
                          <div>
                            <span class=""><small>Total Avg Power:</small></span>
                            <p class="subtitle-2 mb-0 pa-0 text--primary">
                              {{ totalavgPower }}
                            </p>
                          </div>
                        </div>
                      </v-card-text>
                    </v-card>
                  </v-col>
                  </v-row>
                <v-row
                  v-if="machineWiseData && machineWiseData.length"
                  align="center"
                  class="pa-3"
                >
                  <v-col
                    v-for="machineData in machineWiseData"
                    :key="machineData.machineName"
                    cols="12"
                    sm="12"
                    md="6"
                    lg="3"
                    class="mb-auto"
                  >
                    <v-card light elevation="6" class="">
                        <v-card-text>
                          <div>
                          <span class=""><small>Machine Name:</small></span>
                          <p class="subtitle-2 mb-0 pa-0 text--primary">
                            {{ machineData.machineName }}
                          </p>
                          </div>
                          <v-divider class="py-1"></v-divider>
                           <div class="d-flex justify-space-between flex-wrap">
                              <div>
                                <span class=""><small>Energy consumption:</small></span>
                                <v-card-title class="pa-0 text--primary">
                                  {{  machineData.energy }}<sub class="pl-1">KWH</sub></v-card-title
                                >
                              </div>
                              <div>
                                <span class=""><small>Avg Power:</small></span>
                                <v-card-title class="pa-0 text--primary">
                                  {{machineData.avgpower }}<sub class="pl-1">KW</sub></v-card-title
                                >
                              </div>
                            </div>
                        </v-card-text>
                    </v-card>
                  </v-col>
                </v-row>
                </div> -->
                <!-- counter card -->
                <div class="printmedia">
                </div>
                  <!-- graph -->
                  <div class="ma-2" v-if="graphData && graphData.length">
                    <div v-for="(item, index) in graphData" :key="index">
                      <v-card
                        elevation="5"
                        class="my-5"
                        v-if="item && item.paramData && item.paramData.length"
                      >
                        <h2 class="text-uppercase pl-5 py-3">{{ item.parameter }} graph</h2>
                        <div :id="index"></div>
                        <!-- <Plotly
                          :data="item.paramData"
                          :layout="layout"
                          :displayModeBar="true"
                        ></Plotly> -->
                    </v-card>
                      <!-- <v-card v-else elevation="5" class="my-5">
                        <h2 class="pl-5 py-3">
                          No Data found for {{ item.parameter }} graph
                        </h2>
                      </v-card> -->
                      <div class="printmedia">
                      </div>
                    </div>
                  </div>
                  <!-- graph -->
                  <div class="printmedia">
                  </div>
                  <!-- table data -->
                  <div class="my-5 ma-2" v-if="pdfTable && tableColumn && tableRow">
                    <v-data-table
                      :headers="tableColumn"
                      :items="tableRow"
                      :server-items-length="tableRow.length"
                      :items-per-page="tableRow.length"
                      hide-default-footer
                      class="elevation-5"
                    >
                      <template v-slot:top>
                        <v-toolbar flat>
                          <v-toolbar-title>DETAILED REPORT</v-toolbar-title>
                        </v-toolbar>
                      </template>
                    </v-data-table>
                  </div>
                  <!-- table data -->
                
              </v-card>
            </div>
          </v-container>
        </v-main>
      </v-app>
    </div>
    <script src="/ejsAssets/plotly-2.8.3.min.js"></script>
    <script src="/ejsAssets/vue.js"></script>
    <script src="/ejsAssets/vuetify.js"></script>
    <!-- <script src="/ejsAssets/colors.js"></script> -->
    <script>
      new Vue({
        el: "#app",
        vuetify: new Vuetify(),
        data: {

          infoData: JSON.parse('<%- infoData %>'),

          //counter table
          counterTable: JSON.parse('<%- counterPdfTable %>'),
          counterText: JSON.parse('<%- counterText %>'),

          //pdfTable
          // pdfTable: JSON.parse('<%- pdfTable %>'),
          // tableColumn: JSON.parse('<%- pdfTable %>').column,
          // tableRow: JSON.parse('<%- pdfTable %>').row,
          
          //counter
          counterData: JSON.parse('<%- counterData %>'),
          machineWiseData: JSON.parse('<%- counterData %>').machineWiseData,
          totalEnergy: JSON.parse('<%- counterData %>').totalEnergy,
          totalavgPower: JSON.parse('<%- counterData %>').totalavgPower,

          //graph
          graphData: JSON.parse('<%- graphData %>'),
          graphLayout: {
        // title: 'My Graph',
        // plot_bgcolor: '#272727',
        // paper_bgcolor: '#1E1E1E',
            height: 650,
            width: 850,
            paper_bgcolor: "rgba(0,0,0,0)",
            plot_bgcolor: "rgba(0,0,0,0)",
        //margin: {t:0,r:0,b:0,l:20},
        // font: {
        //   color: '#fff',
        // },
        xaxis: {
          title: 'Timestamp',
          // linecolor: '#fff',
          // gridcolor: '#ffffff1f',
          showticklabels: true,
          automargin: true,
        },
        yaxis: {
          title: 'Readings',
          // linecolor: '#fff',
          // gridcolor: '#ffffff1f',
        },
      },
        },
        mounted: function () {
            
          // graphPlot = document.getElementById("counterGraph");
          // Plotly.newPlot(graphPlot, this.productivityGraph, this.counterLayout);
          for (var i in this.graphData) {
            TESTER = document.getElementById(i);
            if(this.graphData[i] && this.graphData[i].paramData && this.graphData[i].paramData.length){
              console.log(this.graphData[i].paramData)
              Plotly.newPlot(TESTER, this.graphData[i].paramData, this.graphLayout, {staticPlot: true, responsive: true});
            }
          }
        },
      });
    </script>
  </body>
</html>
<style>
  @media print {
    .printmedia {
      page-break-after: always;
      margin-top: 30px;
    }
  }
</style>
<style scoped>
  .head {
    width: 100%;
    color: #00215f;
    font-family: sans-serif;
  }
  .title {
    color: #00215f;
    font-size: large;
    font-family:  sans-serif;
  }
  .subtitle {
    color: #00215f;
    font-size: medium;
    font-family: sans-serif;
  }
  .subtitle-head {
    padding-right: 8px;
    color: #00215f;
    font-size: medium;
    font-family: sans-serif;
  }
</style>